<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload SRS</title>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>


    <script src=" https://cdnjs.cloudflare.com/ajax/libs/xls/0.7.4-a/xls.js"></script>

</head>
<body>
<div class="container box">
    <div class="col-lg-11">
        <input type="file" class="btn btn-primary" id="my_file_input"/>
    </div>

    <div class="table-responsive-sm" style="margin-top: 20px">
        <table id="my_file_output" class="table table-hover table-bordered table-striped"></table>
    </div>
</div>
</body>
</html>

<script type="text/javascript">
    var oFileIn;
    var stuInfoArr = [];
    var totalCol = 0;

    $(function () {
        oFileIn = document.getElementById('my_file_input');
        if (oFileIn.addEventListener) {
            oFileIn.addEventListener('change', filePicked, false);
        }
    });

    function filePicked(oEvent) {
        // Get The File From The Input
        var oFile = oEvent.target.files[0];
        var sFilename = oFile.name;
        // Create A File Reader HTML5
        var reader = new FileReader();

        // Ready The Event For When A File Gets Selected
        reader.onload = function (e) {
            var data = e.target.result;
            var cfb = XLS.CFB.read(data, {type: 'binary'});
            var wb = XLS.parse_xlscfb(cfb);
            // Loop Over Each Sheet
            wb.SheetNames.forEach(function (sheetName) {
                // Obtain The Current Row As CSV
                var sCSV = XLS.utils.make_csv(wb.Sheets[sheetName]);
                var data = XLS.utils.sheet_to_json(wb.Sheets[sheetName], {header: 1});
                $.each(data, function (indexR, valueR) {
                    var sRow = "<tr>";
                    $.each(data[indexR], function (indexC, valueC) {
                        sRow = sRow + "<td>" + valueC + "</td>";
                        //    if (indexC == 6 && indexR != 0)
                        //      sRow = sRow + "<td><select name='stuRole' id='stuRole" + indexR + "'><option value=3 selected> Waiter <option value='cashier'> Cashier <option value=6> Bartender <option value='waiter'> Chef </select></td>";
                        totalCol++;
                    });

                    var myData = {
                        'username': data[indexR][6],
                        'password': data[indexR][6],
                        'firstName': data[indexR][2],
                        'lastName': data[indexR][1],
                        'roleId': 2,
                        'bilkentId': data[indexR][3],
                    }

                    stuInfoArr.push(myData);
                    sRow = sRow + "</tr>";
                    $("#my_file_output").append(sRow);
                });
            });
        };

        // Tell JS To Start Reading The File.. You could delay this if desired
        reader.readAsBinaryString(oFile);
        console.log(stuInfoArr);


    }

</script>