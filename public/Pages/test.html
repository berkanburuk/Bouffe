<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <!-- Custom styles for this template -->
    <script src="../TableFiles/vendor/jquery/jquery.min.js"></script>
    <link href="../TableFiles/css/thumbnail-gallery.css" rel="stylesheet">

    <!-- Bootstrap core CSS -->
    <link href="../TableFiles/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <script src='https://cdn.jsdelivr.net/npm/sweetalert2@7.32.2/dist/sweetalert2.all.min.js'></script>
    <title>Title</title>
</head>
<body>
<div class="container box">
    <button type="button" class="btn btn-primary" value="btn1" id="btn" style="margin-top: 20px">Alert
    </button>
    <br/></div>

</body>
</html>

<script>


    $(document).ready(function(){
        $('div#tables div#utable').click( function(e) {

            e.preventDefault();
            var merged = false;
            var activated = false;
            var mergedlist={};
            var y = parseInt($(this).attr('value'));
            var getTable = $.ajax({
                url: '/api/table/getATable/' + y,
                type: "GET",
                statusCode: {
                    404: function () {
                        console.log("-1-1-1-1 WE GOT 404!");
                    },

                    200: function (responseBody) {
                        console.log(responseBody);
                        var dat = JSON.parse(responseBody);
                        console.log(dat);
                        console.log(responseBody);
                        if (dat.status < 1 ) {
                            console.log("-1 Then");
                            if(dat.mergedWith===-2){
                                console.log("-2 Then");
                                var getMerged=$.ajax({
                                    url: '/api/table/getTableMinus',
                                    type: "GET",
                                    statusCode: {
                                        404: function () {
                                            console.log("-1-1-1-1 WE GOT 404!");
                                        },
                                        200: function(respBody2){
                                            var data = JSON.parse(respBody2);
                                            console.log(data.length);
                                            if(data.length===undefined)
                                            {
                                                mergedlist[data.id] = data.id;
                                            }
                                            else {
                                                for (var i = 0; i < data.length; i++) {
                                                    mergedlist[data[i].id] =  data[i].id;
                                                }
                                            }
                                            case0(mergedlist,y);
                                        },
                                    }
                                })
                            }
                            else{
                                case1(y);
                            }
                        }
                        else{
                            if(dat.mergedWith===-2)
                            {
                                console.log("-2 Then");
                                var getMerged=$.ajax({
                                    url: '/api/table/getTableMinus',
                                    type: "GET",
                                    statusCode: {
                                        404: function () {
                                            console.log("-1-1-1-1 WE GOT 404!");
                                        },
                                        200: function(respBody2){
                                            var data = JSON.parse(respBody2);
                                            if(data.length===undefined)
                                            {
                                                mergedlist[data.id] = data.id;
                                            }
                                            else {
                                                for (var i = 0; i < data.length; i++) {
                                                    mergedlist[data[i].id] =  data[i].id;
                                                }
                                            }
                                            case2(mergedlist,y);
                                        },
                                    }
                                })
                            }
                            else{
                                case3(y);
                            }
                        }
                    },
                }
            });
        });
        function case0(text,y) {
            Swal({
                title: 'Are you sure?',
                text: "You won't be able to revert " + y + " this!",
                type: 'warning',
                showCancelButton: true,
                showCloseButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#18426B',
                confirmButtonText: 'Combine',
                cancelButtonText: 'Activate'
            }).then((result) => {
                if (result.value) {
                    Swal.mixin({
                        input: 'select',
                        inputOptions: text,
                        confirmButtonText: 'Next &rarr;',
                        showCancelButton: true,
                    }).queue([
                        {
                            title: 'Manage Table',
                            text: 'Select Table to combine/divide'
                        }]).then((result,id) => {
                        if (result.value) {
                            Swal({
                                title: 'All done!',
                                html:
                                    'Your answers:' +
                                    result.value,
                                confirmButtonText: 'Lovely!'
                            })
                            var data = {
                                tableId1: parseInt(result.value[0]),
                                tableId2: y,
                            };
                            $.ajax({
                                type: 'POST',
                                dataType: 'application/json',
                                url: '/api/table/createAMerge',
                                timeout: 5000,
                                data: data, statusCode: {
                                    200: function (x) {
                                        location.reload();
                                    },
                                    404: function (x) {
                                        alert(x.responseText);
                                    }
                                },
                            })
                        }
                    })
                }
                else if(result.dismiss=== Swal.DismissReason.cancel)
                {
                    Swal(
                        'Anim',
                        'table',
                        'success',
                    ).then(()=>{
                        console.log(y);
                        var data = {
                            tableId: y,
                            status: 1,
                        };
                        $.ajax({
                            type: 'POST',
                            dataType: 'application/json',
                            url: '/api/table/updateStatus',
                            timeout: 5000,
                            data: data, statusCode: {
                                200: function (x) {
                                    location.reload();
                                },
                                404: function (x) {
                                    alert(x.responseText);
                                }
                            },
                        })
                    })
                }
            })
        }
        function case1(text,y) {
            Swal({
                title: 'Attention!',
                text: "You are going to confirm that the order "+text+" with " + y + " id is ready  !",
                type: 'information',
                showCloseButton: true,
                confirmButtonColor: '#3085d6',

                confirmButtonText: 'Ready',

            }).then((result) => {

                        console.log(y);
                        var data = text.split('-'); $.ajax({
                            type: 'GET',
                            dataType: 'application/json',
                            url: '/api/order/chefApprovesFoodReady'+y,
                            timeout: 10000,
                            data: data, statusCode: {
                                200: function (x) {
                                    location.reload();
                                },
                                404: function (x) {
                                    alert(x.responseText);
                                }
                            },
                        })
                    })


        }
        function case2(text,y) {
            Swal({
                title: 'Are you sure?',
                text: "You won't be able to revert " + y + " this!",
                type: 'warning',
                showCancelButton: true,
                showCloseButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#18426B',
                confirmButtonText: 'Combine',
                cancelButtonText: 'Deactivate'
            }).then((result) => {
                if (result.value) {
                    Swal.mixin({
                        input: 'select',
                        inputOptions: text,
                        confirmButtonText: 'Next &rarr;',
                        showCancelButton: true,
                    }).queue([
                        {
                            title: 'Manage Table',
                            text: 'Select Table to combine/divide'
                        }]).then((result,id) => {
                        if (result.value) {
                            Swal({
                                title: 'All done!',
                                html:
                                    'Your answers:' +
                                    result.value,
                                confirmButtonText: 'Lovely!'
                            })
                            console.log(result.value);
                            var data = {
                                tableId1: parseInt(result.value[0]),
                                tableId2: y,
                            };
                            console.log(data);
                            $.ajax({
                                type: 'POST',
                                dataType: 'application/json',
                                url: '/api/table/createAMerge',
                                timeout: 5000,
                                data: data, statusCode: {
                                    200: function (x) {
                                        location.reload();
                                    },
                                    404: function (x) {
                                        alert(x.responseText);
                                    }
                                },
                            })
                        }
                    })
                }
                else if(result.dismiss=== Swal.DismissReason.cancel)
                {
                    Swal(
                        'Anim',
                        'table',
                        'success',
                    ).then(()=>{
                        console.log(y);
                        var data = {
                            tableId: y,
                            status: 0,
                        };
                        $.ajax({
                            type: 'POST',
                            dataType: 'application/json',
                            url: '/api/table/updateStatus',
                            timeout: 5000,
                            data: data, statusCode: {
                                200: function (x) {
                                    location.reload();
                                },
                                404: function (x) {
                                    alert(x.responseText);
                                }
                            },
                        })
                    })
                }
            })
        }
        function case3(y) {
            Swal({
                title: 'Are you sure?',
                text: "You won't be able to revert " + y + " this!",
                type: 'warning',
                showCancelButton: true,
                showCloseButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#18426B',
                confirmButtonText: 'Divide',
                cancelButtonText: 'Deactivate'
            }).then((result) => {

                if (result.value) {
                    Swal(
                        'Tables are unmerged',
                        'table',
                        'success',
                    ).then(()=>{
                        console.log(y);
                        var data={};
                        var send = text.split('-');
                        for(var i=0;i<data.length; i++)
                        {
                            data[i]=send[i];
                        }
                        $.ajax({
                            type: 'POST',
                            dataType: 'application/json',
                            url: '/api/table/unmergeTable',
                            timeout: 5000,
                            data: data, statusCode: {
                                200: function (x) {
                                    location.reload();
                                },
                                404: function (x) {
                                    alert(x.responseText);
                                }
                            },
                        })
                    })
                }
                else if(result.dismiss=== Swal.DismissReason.cancel)
                {
                    Swal(
                        'Anim',
                        'table',
                        'success',
                    ).then(()=>{
                        console.log(y);
                        var data = {
                            tableId: y,
                            status: 0,
                        };
                        $.ajax({
                            type: 'POST',
                            dataType: 'application/json',
                            url: '/api/table/updateStatus',
                            timeout: 5000,
                            data: data, statusCode: {
                                200: function (x) {
                                    location.reload();
                                },

                                404: function (x) {
                                    alert(x.responseText);
                                }
                            },
                        })
                    })
                }
            })
        }
    });

</script>

<script>


    $(document).ready(function() {
        $('div#bodyHere div#order').click(function (e) {

            e.preventDefault();
            var y = parseInt($(this).attr('value'));
            var texty = $(this).attr('name');
            case1(texty, y);
        });

        function case1(text, y) {
            Swal({
                title: 'Attention!',
                text: "You are going to confirm that the order " + text + " with " + y + " id is ready  !",
                type: 'information',
                showCloseButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Ready',
            }).then((result) => {
                console.log(y);
                console.log(y);
                $.ajax({
                    type: 'GET',
                    dataType: 'application/json',
                    url: '/api/order/chefApprovesFoodReady' + y,
                    timeout: 10000,
                    statusCode: {
                        200: function (x) {
                            location.reload();
                        },
                        404: function (x) {
                            alert(x.responseText);
                        }
                    },
                })
            })
        }
    });


</script>>